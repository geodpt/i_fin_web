<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Macro Dashboard</title>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0e1116;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    .page-switch {
      position: fixed;
      top: 10px;
      right: 20px;
      z-index: 999;
      background: #1e1e1e;
      padding: 6px 10px;
      border-radius: 6px;
      box-shadow: 0 0 5px #000;
    }
    .page-switch a {
      color: #ccc;
      margin: 0 8px;
      font-size: 14px;
      text-decoration: none;
    }
    .page-switch a:hover {
      color: white;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 20px;
      font-weight: normal;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls button {
      background-color: #1e1e1e;
      color: white;
      border: 1px solid #444;
      padding: 6px 12px;
      margin: 5px;
      cursor: pointer;
    }
    .controls button.active {
      background-color: #444;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
      gap: 30px;
    }
    .chart-box {
      background-color: #1e1e1e;
      padding: 5px;
      border-radius: 5px;
    }
    canvas {
      background-color: #0e1116;
      height: 320px;
    }
  </style>
</head>
<body>
  <div class="page-switch">
    <a href="currencies.html">ðŸ’± Currencies</a>
    <a href="macro.html">ðŸ“Š Macro</a>
  </div>

  <h2>Macro Indicators</h2>

  <div class="controls">
    <button onclick="updateAllCharts('1M')">1M</button>
    <button onclick="updateAllCharts('12M')" class="active">1Y</button>
    <button onclick="updateAllCharts('60M')">5Y</button>
    <button onclick="updateAllCharts('240M')">20Y</button>
  </div>

  <div class="grid" id="chartGrid">
    <div class="chart-box"><div id="chart_gold"></div></div>
    <div class="chart-box"><div id="chart_silver"></div></div>
    <div class="chart-box"><div id="chart_spx"></div></div>
    <div class="chart-box"><canvas id="chart_10y"></canvas></div>
    <div class="chart-box"><canvas id="chart_1y"></canvas></div>
    <div class="chart-box"><canvas id="chart_cpi"></canvas></div>
  </div>

<script>
async function loadFREDChart(chartId, seriesId, label) {
  try {
    const res = await fetch(`https://api.stlouisfed.org/fred/series/observations?series_id=${seriesId}&api_key=25651c703c76d387f56906d055ce76ef&file_type=json`);
    const data = await res.json();
    const obs = data.observations.filter(o => !isNaN(parseFloat(o.value)));
    const labels = obs.map(o => o.date).slice(-365);
    const values = obs.map(o => parseFloat(o.value)).slice(-365);

    if (!labels.length || !values.length) {
      console.error(`No data loaded for ${chartId}`, data);
      return;
    }

    const ctx = document.getElementById(chartId).getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{ label, data: values, borderColor: "orange", borderWidth: 1.5, pointRadius: 0, tension: 0.1 }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: "white" }},
          title: { display: true, text: label, color: "white" }
        },
        scales: {
          x: { ticks: { color: "white" }, grid: { color: "#333" } },
          y: { ticks: { color: "white" }, grid: { color: "#333" } }
        }
      }
    });
  } catch (e) {
    console.error(`Error loading ${chartId}`, e);
  }
}

["chart_10y", "chart_1y", "chart_cpi"].forEach((chartId) => {
  const series = {
    chart_10y: { id: "GS10", label: "10Y Treasury Yield (%)" },
    chart_1y: { id: "GS1", label: "1Y Treasury Yield (%)" },
    chart_cpi: { id: "CPIAUCSL", label: "US CPI (Index)" }
  };
  loadFREDChart(chartId, series[chartId].id, series[chartId].label);
});
</script>

</body>
</html>
